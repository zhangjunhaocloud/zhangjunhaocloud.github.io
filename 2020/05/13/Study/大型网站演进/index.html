<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>大型网站演进 | 云顶小栈 | 小栖片刻</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="大型网站">
    <meta name="description" content="什么样的网站才算是大型网站?    从网站的技术指标角度考虑这个问题，人们很容易犯一个毛病就是认为网站的访问量是衡量的指标，懂点行的人也许会认为是网站在单位时间里的并发量的大小来作为指标，如果按这些标准那么像hao123这样的网站就是大型网站了，虽然这种网站访问量非常大，并发数也非常高，但是它却能用最为简单的web技术来实现：我们只要保持网站的充分的静态化，多部署几台服务器，那么就算地球上所有人">
<meta property="og:type" content="article">
<meta property="og:title" content="大型网站演进">
<meta property="og:url" content="https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/index.html">
<meta property="og:site_name" content="云顶小栈">
<meta property="og:description" content="什么样的网站才算是大型网站?    从网站的技术指标角度考虑这个问题，人们很容易犯一个毛病就是认为网站的访问量是衡量的指标，懂点行的人也许会认为是网站在单位时间里的并发量的大小来作为指标，如果按这些标准那么像hao123这样的网站就是大型网站了，虽然这种网站访问量非常大，并发数也非常高，但是它却能用最为简单的web技术来实现：我们只要保持网站的充分的静态化，多部署几台服务器，那么就算地球上所有人">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/%E5%88%9D%E5%A7%8B.png">
<meta property="og:image" content="https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.png">
<meta property="og:image" content="https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95.png">
<meta property="og:image" content="https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E4%B8%80.png">
<meta property="article:published_time" content="2020-05-13T02:51:00.000Z">
<meta property="article:modified_time" content="2020-05-17T08:54:10.736Z">
<meta property="article:author" content="张峻豪">
<meta property="article:tag" content="大型网站">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/%E5%88%9D%E5%A7%8B.png">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">张峻豪</h5>
          <a href="mailto:zhangjunhaocloud@outlook.com" title="zhangjunhaocloud@outlook.com" class="mail">zhangjunhaocloud@outlook.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zhangjunhaocloud" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">大型网站演进</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">大型网站演进</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-05-13T02:51:00.000Z" itemprop="datePublished" class="page-time">
  2020-05-13
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99/">大型网站</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    

<article id="post-Study/大型网站演进"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">大型网站演进</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-05-13 10:51:00" datetime="2020-05-13T02:51:00.000Z"  itemprop="datePublished">2020-05-13</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99/">大型网站</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <ol>
<li><p>什么样的网站才算是大型网站?  </p>
<blockquote>
<p>从网站的技术指标角度考虑这个问题，人们很容易犯一个毛病就是认为网站的访问量是衡量的指标，懂点行的人也许会认为是网站在单位时间里的并发量的大小来作为指标，如果按这些标准那么像hao123这样的网站就是大型网站了，虽然这种网站访问量非常大，并发数也非常高，但是它却能用最为简单的web技术来实现：我们只要保持网站的充分的静态化，多部署几台服务器，那么就算地球上所有人都用它，网站也能正常运行。 正确的大型网站是：技术和业务的结合，一个满足某些用户需求的网站只要技术和业务二者有一方难度很大，必然会让企业投入更多的、更优秀的人力成本实现，那么这样的网站就是所谓的大型网站。</p>
</blockquote>
</li>
<li><p>初始网站结构</p>
<blockquote>
<p>一个初建的网站往往用户群都是很小的，最简单的网站架构就能解决实际的用户需求，当然为了保证网站的稳定性和安全性，我们会把网站的应用部署到至少两台机器上，后台的存储使用数据库，如果经济实力允许，数据库使用单台服务器部署，由于数据是网站的生命线，因此我们常常会部署数据库的服务器使用的好点  </p>
</blockquote>
<img src="/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/%E5%88%9D%E5%A7%8B.png" class="" title="初始">
</li>
<li><p>使用多台服务器部署网站服务应用的目的</p>
<blockquote>
<ol>
<li>保证网站的可用性，多台服务器部署应用，那么其中一些服务器挂掉了，只要网站还有服务器能正常运转，那么网站对外仍然可以正常提供服务  </li>
<li>提高网站的并发量，服务器越多那么网站能够服务的用户，单位时间内能承载的请求数也就越大</li>
</ol>
</blockquote>
</li>
<li><p>如何保证多台服务器之间session信息的同步</p>
<blockquote>
<p>最直接的方案就是让服务器之间session不断的传递和复制。但有一个现象：当需要同步的web容器越多,web应用所能承载的并发数并没有因为服务器的增加而线性提升，当服务器数量达到一个临界值后，整个web应用的并发数甚至还会下降，原因就是，不同服务器之间session的传递和复制会消耗服务器本身的系统资源，当服务器数量越大，消耗的资源越多，当用户请求越频繁，系统消耗资源也会越来越大。<br>注：如果我们多部署服务器的目的只是想保证系统的稳定性，采用这种方案还是不错的，不过web应用最好部署少点，这样才不会影响到web应用的性能问题</p>
</blockquote>
</li>
<li><p>提升网站的并发量该采取何种方案</p>
<blockquote>
<p>时下使用的比较多的方案就是使用独立的缓存服务器，也就是将session的数据存储在一台独立的服务器上，如果觉得存在一台服务器不安全，那么可以使用memcached这样的分布式缓存服务器进行存储，这样既可以满足网站稳定性问题也提升了网站的并发能力<br>在web服务器之前部署F5等负载均衡的硬件设备(作用是将用户请求均匀的分发到后台的服务器集群)<br>在web服务器之前部署LVS等负载均衡的软件设备</p>
</blockquote>
</li>
<li><p>网站在高并发下挂掉的原因分析</p>
<blockquote>
<p><strong>90%</strong>都是因为数据库不堪重负所致，而应用的瓶颈往往只有在解决了存储瓶颈后才会暴露，那么我们要升级网站能力的第一步工作就是提升<strong>数据库</strong>的<strong>承载能力</strong>,对于<strong>读</strong>远大于<strong>写</strong>的网站我们采取的方式就是将数据库从读写这个角度拆分,具体操作就是将数据库<strong>读写分离</strong>  </p>
</blockquote>
<img src="/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.png" class="" title="读写分离">  
<p>数据库的读写分享可以有效的保证关键数据的安全性，但是有个缺点就是当用户浏览数据时，<strong>读的数据都会有点延时</strong>.相对12306的场景，仅仅<strong>读写分离</strong>还是远远不够的，特别是负责读操作的副库，在高访问下也是很容易达到性能的瓶颈的，那么我们就得使用新的解决方案：<strong>分布式缓存</strong>，不过缓存的缺点就是不能有效的实时更新，因此我们使用缓存前首先要对读操作的数据进行<strong>分类</strong>，对于那些经常不发生变化的数据可以事先存放到缓存里，缓存的访问效率很高，这样会让读更加高效，同时也减轻了数据库的访问压力。主库也有一个读的压力就是主库和副库的数据同步问题，不过同步数据都是批量操作，不像请求那样进行少量的数据读取操作，相对达到瓶颈有一定的难度。更进一步 美国牛逼的facebook对数据的任何操作都是事先合并为批量操作，从而达到减轻数据库压力的目的</p>
</li>
<li><p>对于请求大数据量的解决方案</p>
<blockquote>
<p>对于海量数据的读我们可以采用搜索技术，可以将数据库的数据导出到文件里，对文件建立索引，使用倒排技术来检索信息。搜索技术非常适合于模糊查询操作。</p>
</blockquote>
</li>
<li><p>memcached实现的原理</p>
<blockquote>
<p>当网站使用缓存集群时候,缓存数据是通过一定的算法将缓存数据尽量均匀分布到不同服务器上,如果用户A的缓存在服务器A上,那么服务器B上是没有该用户的缓存数据,早期的memcache数据分布式的算法是根据缓存数据的key即键值计算出一个hash值.这个hash值再除以缓存服务器的个数,得到的余数会对应某一台服务器.由于此算法过于依赖服务器个数,如若其中一台服务器挂掉,那么网站损失的缓存数据的占比就会比较高,为此,memcached引入一致性hash算法.</p>
</blockquote>
</li>
<li><p>将数据库读写分离为何能产生好的效率?</p>
<blockquote>
<p>主要是因为硬盘的机制.硬盘的物理机制就有一个大圆盘飞速旋转,然后有个磁头不断扫描这个大圆盘,这样的物理机制就会导致硬盘数据的<strong>顺序操作和</strong>比<strong>随机操作</strong>效率更高,这点对于硬盘的读和写还算公平,但是写操作在高并发情况下会有点复杂,写操作有个特性就是我们要保证写操作的准确性,但是高并发下可能会出现多个用户同时修改某一条数据,<strong>为了保证数据能被准确的修改,那么我们通常要把并行的操作转变为串行操作</strong>,这个时候就会出现一个锁机制,锁机制的实现是很复杂的,它会消耗很多系统性能,如果写操作掺杂了读操作情况就更复杂,效率会更加低效,相对于写操作读操作就单纯多了,如果我们的数据只有读操作,那么读的性能也就是硬盘顺序读能力和随机读能力的体现,即使掺杂了并发也不会对其有很大的影响,困此如果把读操作和写操作分离,效率自然会得到提升.</p>
</blockquote>
</li>
<li><p>读写分离可提升存储系统的效率,为什么还要引入缓存系统和搜索技术?</p>
<blockquote>
<p>缓存将数据存在内存中,内存效率是硬盘的几万倍,好处不言而喻,而选择搜索技术的背后的原理就不同了,数据库存储的数据称之为结构化数据,结构化数据的限制很多,当结构化数据遇到千变万化的随机访问的时候,其效率会变得异常低效,但是如果一个网站不能提供奶油小生、高效的随机访问能力，那么这个网站就会变得单板没有活力，数据库对于like操作效率低下，而搜索技术在随机访问的能力正好可以弥补数据库在这块的不足。</p>
</blockquote>
</li>
<li><p>如何解决主库的瓶颈?</p>
<blockquote>
<p>拆分主库的数据，系统的短板往往是那些数据量最大的表，可以把这些数据量大的表单独建立数据库，这种拆分数据库的做法叫做<strong>数据的垂直拆分</strong>，相应的会给原来的数据库查询产生影响。当这些表的数据处理超出单台服务器的能力的时候，我们可以把表分布到两台不同的数据库里，这种做法叫做<strong>数据的水平拆分</strong><br>垂直拆分：把一个数据库中不同业务单元的数据分到不同的数据库里<br>水平拆分：根据一定的规则把同一业务单元的数据拆分到多个数据库里</p>
</blockquote>
</li>
<li><p>解决大型网站数据瓶颈的脉络</p>
<blockquote>
<p>单库数据库–&gt;数据库读写分离–&gt;缓存技术–&gt;搜索技术–&gt;数据的垂直拆分–&gt;数据的水平拆分</p>
</blockquote>
</li>
<li><p>拆分数据库对现有系统影响较大,应该遵循哪些原则</p>
<blockquote>
<p>大型网站解决存储瓶颈的问题,我们要找找准存储这个关键点,因为数据库其实是存储和运算的组合体,但是在我们这个场景下,存储是第一位的,当存储是瓶颈时候我们要狠下心来尽量多的抛弃数据的计算特点,所以上文中我提出我们数据库就不要滥用计算功能了例如触发器、存储过程等等<br>数据库剥离计算功能不代表不要数据的计算功能，因为没有数据的计算功能数据库也就没价值了，那么我们要将数据库的计算功能进行迁移，迁移到程序里面，一般大型系统和数据库都是分开部署到不同服务器上，因此程序里处理数据计算就不会影响到数据库所在服务器的性能，就可以让安装数据库的服务器专心服务于存储<br>我们要尽一切可能的把数据库的变化对服务层的影响降到最低，最好是数据库做拆分后，现有业务不要任何的更改，那么我们就行设计一个全新的数据访问层，这个数据访问层将数据库和服务层进行解耦，任何数据库的变化都由数据访问层消化，数据访问层对外接口要高度统一，不要轻易改变<br>如果我们设计了数据访问层来解决数据库拆分的问题,数据访问层加上数据库其实就组合出了一个分布式数据库的解决方案,由此可见拆分数据库的难度是很高的,因为数据库将拥有分布式的特性,而分布式开发就意味开发难度的增加<br>对于分布式事务的处理,我们尽量要从具体问题具体分析,不要一感觉这个事务操作本质是分布式就去寻找通用的分布式事务技术手段,这样的想法其实是回避困难的思想,结果可能会是把问题搞得更加复杂  </p>
</blockquote>
</li>
<li><p>水平拆分面临的难题</p>
<blockquote>
<p>难题一：数据库的表被水平拆分后,该表的主键设计会变得十分困难<br>难题二：原来单表的查询逻辑会面临挑战<br>难题三：水平拆分表后，外键的设计会变得十分困难<br>难题四：针对数据的新增操作，我们要按什么规则把需要存储的数据存储在拆分出的具体哪个物理数据表里  </p>
</blockquote>
</li>
<li><p>水平拆分主键设计原则</p>
<blockquote>
<p>第一原则：被水平拆分的表的主键设计最好使用一个字段</p>
</blockquote>
</li>
<li><p>水平拆分主键设计的具体方案</p>
<blockquote>
<p>对于可以以自增列为主键的方案有二；<br>方案一：利用自增列可设定步长的特性，可把第一张表步长设计为2，起始值为1，自增规律就是1,3,5,7依次类推,第二张表步长设计为2,起始值为2,那么自增规律就是2,4,6,8以此类推,这样两张表的主键就绝对不会重复了,而且我们也不用另外做两张物理表相应的逻辑关联了.这个方案潜在的好处是步长的大小和水平数据拆分的粒度关联,也是我们为水平拆分的扩容留有余量,例如我们把步长设计为9,那么理论上拆分的物理表可以扩容到9个<br>方案二：拆分出的物理表我们允许它最多存储多少数据，我们其实事先通过一定业务技术规则大致估算出来，假如我们估算一张表最多存储2亿条，那么我们可以设定自增列的规律，第一张物理表自增列从1开始，步长设为1，第二种物理表的自增列则从2亿开始，步长也设为1，自增列做最大值的限制，其他的依次类推<br>对于主键不是自增列的主键方案有二：<br>方案一：使用整数哈希求余的算法，字符串如果进行哈希运算会得出一个值，这个值是该字符串的唯一标志，如果我们稍微改变下字符串的内容，计算的哈希值肯定是不同的，两个不同的哈希值对应两个不同字符串，一个哈希值有且只有对应唯一一个字符串，加密算法里的MD5，SHA都是使用哈希算法的原理计算出一个唯一标示的哈希值，通过哈希值的匹配可以判断数据是否被篡改过。不过大多数哈希算法最后得出的值都是一个字符加数字的组合，这里我们使用整数哈希算法，这样计算出的哈希值就是一个整数。接下来就要统计下我们用于做水平拆分的服务器的数量，假如服务器的数量是3个，那么接着我们将计算的整数哈希值除以服务器的数量即取模计算，通过得到的余数来选择服务器，原理如下：  </p>
</blockquote>
<img src="/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95.png" class="" title="哈希算法">    
<blockquote>
<p>方案二：方案一的升级版<strong>一致性哈希</strong>，一致性哈希最大的作用是<strong>凭证当我们要扩展物理数据表的数量时候以及物理表集群中某台服务器失效时才能体现</strong></p>
</blockquote>
</li>
<li><p>为什么不用语言自带的UUID作为主键唯一性问题的解决方案(把主键生成规则做成一个主键生成系统，放置在单独一台服务器上统一生成，每次新增数据主键都从这个服务器获取)</p>
<blockquote>
<p>有以下缺点<br>缺点一：把主键生成放到外部服务器进行，这样我们就不得不通过网络通信完成主键值的传递，而网络是计算机体系里效率最低效的方式，因此它会影响数据新增的效率，特别是数据量很大的时候，新增操作很频繁时候，该缺点会被放大很多<br>缺点二：如果我们使用UUID算法做主键生成的算法，因为UUID是依赖单台服务器进行，那么整个水平拆分的物理数据库集群，主键生成器就变成整个体系的短板，而且是关键短板，主键生成服务器如果失效，整个系统都会无法使用，而一张表需要被水平拆分，而且拆分的表是业务表的时候，那么这张表在整个系统里的重要度自然很高，它如果做了水平拆分后出现闪电战故障，这对于整个系统都是致命的。<br>缺点三：使用外部系统生成主键使得我们的水平拆分数据库的方案增加了状态性，有状态的系统会相互影响，例如使用外部系统生成主键，那么当数据操作增大时，必须会造成在主键系统上资源竞争的事情发生，如果我们对主键系统上的竞争状态处理不好，很有可能造成主键系统被死锁，这也就会产生503错误，而无状态的系统是不存在资源竞争和死锁的问题，这样就提升了系统的健壮性，无状态系统另一个优势就是水平扩展很方便。</p>
</blockquote>
</li>
<li><p>缓存的特点</p>
<blockquote>
<p>特点一：缓存主要是适用于读操作，并且缓存的读操作的效率要远远高于从数据库以及硬盘读取数据的效率<br>特点二：缓存的数据是存储在内存当中，因此当系统重启，宕机等等异常场景下，缓存数据就会不可逆的丢失，且无法恢复，因此缓存不能作为可靠存储设备，这就导致一个问题，缓存里的数据必须首先从数据库里同步到内存中，而使用缓存的目的就是为了解决数据库的读操作效率低下的问题，数据库的数据同步到缓存的操作会因为数据库的效率低下而在性能上大打折扣，所以缓存适合的场景是那些固定不变的数据以及业务对实时性变化要求不高的数据。</p>
</blockquote>
</li>
<li><p>对数据库拆分的一些启迪</p>
<blockquote>
<p>启迪一：数据库的读写分离不是简单的把主库数据导入到读库里就能解决问题，读数据库和写数据的分离的目的是为了让读和写操作不能相互影响效率<br>启迪二：解决读的瓶颈问题的本质是减少数据的检索范围，数据检索的范围越小，读的效率也就越高<br>启迪三：数据库的垂直拆分和水平拆分首先不应该从技术角度进行，而是通过业务角度进行，如果数据库进行业务角度的水平拆分，那么拆分的维度往往是要根据该表的某个字段进行的，这个字段选择要有一定原则，这个原则主要是该字段的维度的粒度不能过细，该字段的维度范围不能经常的动态发生变化，最后就是该维度不能让数据分布严重失衡</p>
</blockquote>
</li>
<li><p>分表的工作之所以让人烦恼的原因</p>
<blockquote>
<p>原因一：一个数据库能容纳多少张表是有一定限制的，就算没有超过这个限制，如果原库有30张表，我们拆分后变成60张甚至90张，那么数据库本身管理这么多表也会消耗很多性能，因此公司的DBA往往会控制那些过多分表的行为<br>原因二：每次拆表后，都会牵涉到历史数据的迁移问题，这个迁移风险很大，迁移方案如果设计的不完善可能会导致数据丢失或者损坏，如果关键数据发生了丢失和损坏，结果可能非常致命。因此在设计数据库分表分库方案时我们要尽量让受影响的数据范围变得最小<br>原因三：每次拆表和分表都会让系统的相关方蹦紧神经，方案执行后，会有很长时间的监控和观察期，所以拆数据库时常是一件令人讨厌的事情<br>原因四：为了保证新方案执行后确保系统没有问题，我们常常会让新旧系统并行运行一段时间，这样可以保证如果新方案出现问题，问题的影响面最低，但是这种做法也有一个恶果就是会导致数据迁移方案要进行动态调整，从而增加迁移数据的风险</p>
</blockquote>
</li>
<li><p>关系型数据库的痛点</p>
<blockquote>
<p>痛点一：数据库的连接数不够用。换句话说就是在同一时间内，要求和数据库建立连接的请求超出了数据库所允许的最大连接数，如果我们对超出的连接数没有进行有效的控制让它们直接落到了数据库上，那么就有可能让数据库不堪重负，那么我们就要分散这些连接，或者让请求排队<br>痛点二：对于数据库表的操作无非两种，一种是写操作，一种是读操作。在现实场景下很难出现读写都成问题的事情，往往是其中一种表的操作出现了瓶颈问题所引起的，由于读和写都是操作同一个介质，这就导致如果我们不对介质进行拆分去单独解决读的问题或者写的问题会让问题变得复杂化，最后很难从根本上解决问题<br>痛点三：实时计算和海量数据的矛盾。在现实中，数据库里表的数据都会随着时间推移而不断增长，当表的数据超出了一定规模后，受制于计算机硬盘、内存以及CPU本身的能力，我们很难完成对这些数据的实时处理，因此我们就必须要采取新的手段解决这些问题<br>痛点四：当数据库所在服务器的硬件有很大提升的时候，我们可以优先考虑是否可以通过提升硬件性能的手段来提升数据库的性能  </p>
</blockquote>
</li>
<li><p>数据库水平扩展具体指什么</p>
<blockquote>
<p>数据库的水平扩展是指通过<strong>增加服务器</strong>的方式提升整个存储层的性能<br>数据库的水平扩展基本都是基于<strong>水平拆分</strong>进行的,也就是说数据库的水平扩展是在数据库水平拆分后再进行一次水平拆分,水平扩展的次数也就代表的水平拆分迭代的次数.因此要谈好数据库的水平扩展问题,我们首先要更加细致的分析下水平拆分的方案,当然这里所说的水平拆分方案指的是狭义的水平拆分</p>
</blockquote>
</li>
<li><p>一致性哈希的原理</p>
<blockquote>
<img src="/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E4%B8%80.png" class="" title="一致性哈希一">  
<p>一致性哈希望使用时候首先要计算出用来做水平拆分服务器的数字哈希值,并将这些哈希值配置到0~2<sup>32</sup>的圆上,接着计算出被存储数据主键的数字哈希值,并把它们映射到这个圆上,然后唑数据映射到的位置开始顺时针查找,并将数据保存在找到的第一个服务器上,如果主键的哈希值超过了2<sup>32</sup>,那么该记录就会保存在第一台服务器上.如果添加一个新节点,例图只使用了4个节点,影响到了25%的数据,这个影响度还是有点大,如何降低影响呢,我们可以增加大量的虚拟节点来进一步抵制数据分布不均衡</p>
</blockquote>
</li>
<li><p>水平扩展的排序问题</p>
<blockquote>
<p>首先要明确一点,对海量数据进行全排序,而这个全排序还要以实时的要求进行,这个是根本无法完成的,这主要是因为目前的计算机绝对没有这个能力.如何解决排序难题:<br>方法一:缩小需要排序的数据大小,那么数据库的分区技术是一个很好的手段,除了分区手段外,还有一个手段就是搜索技术.</p>
</blockquote>
</li>
<li><p>在每个服务端之前部署一个静态web服务器的好处</p>
<blockquote>
<p>好处一：方便日志的记录<br>好处二：在服务端之前设立了一个安全屏障,即静态web服务器可以在必要时候过滤有害的请求<br>好处三：可以控制注入到服务端的请求个数，当并发很高时候，可以利用静态web服务器能承担更高的能力来缓冲服务端的压力<br>好处四：可以便于我们做动静分离</p>
</blockquote>
</li>
<li><p>如何区分一个页面什么内容是动态的，什么内容是静态的</p>
<blockquote>
<p>一个比较简单的方法就是：同一URL，访问的时候不同，最后展示的页面也不一样那么这个页面就是动态页面，反之则是静态页面。当然除了时间维度外，还应该考虑被拆分的资源是否需要服务端应用加以配合。除此之外，服务端应用和结果的密切度也是要当做考虑的因素的。</p>
</blockquote>
</li>
<li><p>MVC中控制器主要完成的工作</p>
<blockquote>
<p>工作一：控制层起到一个路由的作用<br>工作二：控制层起到一个报文信息格式转化的作用<br>工作三：传统的MVC框架里，控制层其实深入参入到了页面渲染的操作</p>
</blockquote>
</li>
<li><p>正向代理与反向代理</p>
<blockquote>
<p><strong>正向代理</strong>是代理<strong>浏览器</strong>来访问<strong>互联网</strong>，<strong>反向代理</strong>是指代理不再是代理浏览器侧了，而是<strong>反过来</strong>代理浏览器需要访问的<strong>应用服务器</strong></p>
</blockquote>
</li>
<li><p>反向代理的使用目的</p>
<blockquote>
<p>目的一：反向代理可以隐藏真实的应用服务器。<br>目的二：反向代理可以实现负载均衡的功能<br>目的三：反向代理可以起到动态调节应用服务器并发数的目的<br>目的四：反向代理可以缓存静态数据</p>
</blockquote>
</li>
</ol>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-05-17T08:54:10.736Z" itemprop="dateUpdated">2020-05-17 16:54:10</time>
</span><br>


        
        此网站所有内容仅表示作者个人看法,如有说得不合看官心意的请多多谅解!
        
    </div>
    
    <footer>
        <a href="https://zhangjunhaocloud.github.io">
            <img src="/img/avatar.jpg" alt="张峻豪">
            张峻豪
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99/" rel="tag">大型网站</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/&title=《大型网站演进》 — 云顶小栈&pic=https://zhangjunhaocloud.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/&title=《大型网站演进》 — 云顶小栈&source=记录自己成长经历" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《大型网站演进》 — 云顶小栈&url=https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/&via=https://zhangjunhaocloud.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/05/17/Study/%E5%8D%9A%E5%AE%A2%E5%9B%AD%E6%8A%80%E6%9C%AF%E7%B3%BB%E7%BB%9F%E6%96%87%E7%AB%A0V1.0/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">博客园技术系统文章V1.0</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/05/11/%E5%89%8D%E7%AB%AF/JS/JS%E6%8E%A7%E5%88%B6%E6%96%87%E6%9C%AC%E6%A1%86%E7%A6%81%E6%AD%A2%E8%BE%93%E5%85%A5%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">JS控制文本框禁止输入特殊字符</h4>
      </a>
    </div>
  
</nav>



    

</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢客官~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>张峻豪 &copy; 2011 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/&title=《大型网站演进》 — 云顶小栈&pic=https://zhangjunhaocloud.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/&title=《大型网站演进》 — 云顶小栈&source=记录自己成长经历" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《大型网站演进》 — 云顶小栈&url=https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/&via=https://zhangjunhaocloud.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://zhangjunhaocloud.github.io/2020/05/13/Study/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%BC%94%E8%BF%9B/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'stay hungry stay foolish！';
            clearTimeout(titleTime);
        } else {
            document.title = '欢迎您的光临!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
